I"zd<hr />
<h3 id="web-crawling">Web Crawling</h3>
<ul>
  <li>ê°€ìƒí™˜ê²½ ë° scrapy í”„ë¡œì íŠ¸ êµ¬ì¶•</li>
  <li>ì‚¬ì „ í™•ì¸</li>
  <li>Requests</li>
  <li>Requests í•œê¸€ ê¹¨ì§</li>
  <li>Code
    <ul>
      <li>items.py</li>
      <li>spiders/kidnews_spider.py</li>
      <li>pipelines.py</li>
      <li>settings.py</li>
    </ul>
  </li>
  <li>scrapy ì‹¤í–‰</li>
</ul>

<hr />

<h3 id="ê°€ìƒí™˜ê²½-ë°-scrapy-í”„ë¡œì íŠ¸-êµ¬ì¶•">ê°€ìƒí™˜ê²½ ë° scrapy í”„ë¡œì íŠ¸ êµ¬ì¶•</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ê°€ìƒí™˜ê²½ êµ¬ì¶•</span>
python3 <span class="nt">-m</span> venv venv
<span class="nb">source </span>venv/bin/activate

<span class="c"># python library ì„¤ì¹˜</span>
pip3 <span class="nb">install </span>scrapy
pip3 <span class="nb">install </span>ipykernel
pip3 <span class="nb">install </span>pymongo
pip3 <span class="nb">install </span>requests

<span class="c"># jupyter notebook kernel êµ¬ì¶•</span>
python3 <span class="nt">-m</span> ipykernel <span class="nb">install</span> <span class="nt">--user</span> <span class="nt">--name</span> venv <span class="nt">--display-name</span> <span class="s2">"venv_scrapy"</span>

<span class="c"># scrapy project ì‹œì‘</span>
scrapy startproject kidnewscrawling
</code></pre></div></div>
<hr />

<h3 id="ì‚¬ì „-í™•ì¸">ì‚¬ì „ í™•ì¸</h3>
<ul>
  <li>interested_url/robots.txt ë¥¼ í†µí•´ crawling ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
    <ul>
      <li>ì˜ˆ) http://kid.chosun.com/robots.txt</li>
      <li>ì•„ë˜ëŠ” crawling ë¶ˆê°€ëŠ¥í•œ ì˜ì—­
        <ul>
          <li>Disallow: /sv*</li>
          <li>Disallow: /list*</li>
          <li>Disallow: /cartoonlist*</li>
          <li>Disallow: /priv*</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="requests">Requests</h3>
<ul>
  <li>Requests ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ì—¬ xpath/css ì°¾ê¸°</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">scrapy</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">request_object</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://kid.chosun.com/site/data/html_dir/2022/01/31/2022013100293.html'</span><span class="p">)</span>

<span class="k">if</span> <span class="s">'charset'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request_object</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'content-type'</span><span class="p">]:</span>
    <span class="n">request_object</span><span class="p">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">request_object</span><span class="p">.</span><span class="n">apparent_encoding</span>

<span class="n">response_object</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">request_object</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">response_object</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@class="Paragraph"]//div[not(contains(@class, "center_img"))]//text()'</span><span class="p">).</span><span class="n">extract</span><span class="p">())</span>
<span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">'[&lt;ì‚¬ì§„&gt;\xa0]'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">p</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'í˜¸ì£¼ ì •ë¶€ê°€ ì½”ì•Œë¼ ìƒíƒœê³„ë¥¼ ë³´ì „í•˜ê¸° ìœ„í•´ 400ì–µ ì›ì´ ë„˜ëŠ” ëˆì„ ìŸì•„ë¶“ê¸°ë¡œ í–ˆë‹¤. 29ì¼(í˜„ì§€ ì‹œê°) CNNì— ë”°ë¥´ë©´ í˜¸ì£¼ ì •ë¶€ëŠ” ì½”ì•Œë¼ ê°œì²´ ìˆ˜(æ•¸)ë¥¼ ë³´í˜¸í•˜ê¸° ìœ„í•´ ì•ìœ¼ë¡œ 4ë…„ê°„ 5000ë§Œ í˜¸ì£¼ë‹¬ëŸ¬(ì•½ 422ì–µ ì›)ë¥¼ íˆ¬ìí•œë‹¤. ìŠ¤ì½§ ëª¨ë¦¬ìŠ¨ í˜¸ì£¼ ì´ë¦¬ëŠ” â€œì½”ì•Œë¼ëŠ” ì„¸ê³„ì—ì„œ ë‘ë°›ëŠ” í˜¸ì£¼ì˜ ìƒì§•â€ì´ë¼ë©° â€œë‹¤ìŒ ì„¸ëŒ€ë¥¼ ìœ„í•´ ìµœì„ ì„ ë‹¤í•´ ì½”ì•Œë¼ë¥¼ ë³´í˜¸í•´ì•¼ í•œë‹¤â€ê³  ë°í˜”ë‹¤. ì •ë¶€ ì˜ˆì‚°ì€ ì½”ì•Œë¼ ì„œì‹ì§€ ë³µì›ê³¼ ì¹˜ë£Œ, ì—°êµ¬ ë“±ì— ìš©ëœë‹¤. ì§€ë‚œí•´ 9ì›” í˜¸ì£¼ ì½”ì•Œë¼ ì¬ë‹¨ì´ ë°œí‘œí•œ ë‚´ìš©ì— ë”°ë¥´ë©´ 2018ë…„ ì´í›„ ì‚°ë¶ˆ, ê°€ë­„, í† ì§€ ê°œê°„(é–‹å¢¾) ë“±ìœ¼ë¡œ í˜¸ì£¼ì— ì„œì‹í•˜ëŠ” ì½”ì•Œë¼ì˜ ì•½ 30ï¼…ê°€ ë¼ì¡Œë‹¤. íŠ¹íˆ 2019ë…„ ë‰´ìš°ìŠ¤ì›¨ì¼ì¦ˆì˜ ë•… 4ë§Œ8000ã¢ì„ íŒŒê´´í•œ ëŒ€í˜• ì‚°ë¶ˆì€ ì½”ì•Œë¼ ê°œì²´ ê°ì†Œì— ì¹˜ëª…ì ì´ì—ˆë‹¤. í˜„ì¬ ì½”ì•Œë¼ëŠ” ì„¸ê³„ ìµœëŒ€ í™˜ê²½ë³´í˜¸ ê¸°êµ¬ì¸ â€˜ì„¸ê³„ìì—°ë³´ì „ì—°ë§¹(IUCN)â€™ì´ ì •í•˜ëŠ” â€˜ì·¨ì•½ì¢…(ç¨®)â€™ ëª©ë¡ì— ì˜¬ë¼ìˆë‹¤. *ì½”ì•Œë¼ë¥¼ ë³´í˜¸í•˜ëŠ” ë°©ë²•ì„ ì •ë¦¬í•´ ì•Œë ¤ì£¼ì„¸ìš”.'
</code></pre></div></div>

<hr />

<h3 id="requests-í•œê¸€-ê¹¨ì§">Requests í•œê¸€ ê¹¨ì§</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">request.headers['content-type']</code> - text/htmlì¸ ê²½ìš° ì¸ì½”ë”© ë¬¸ì œ ë°œìƒ</li>
  <li>í•´ê²°
    <ul>
      <li>ë°©ë²•1 - request.encodingì„ ì§ì ‘ì ìœ¼ë¡œ ìˆ˜ì •</li>
      <li>ë°©ë²•2 - request.encodingì„ request.apparaent_encodingìœ¼ë¡œ ë³€í™˜</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://kid.chosun.com/list_kj.html?catid=1'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'content-type'</span><span class="p">])</span> 
<span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">apparent_encoding</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">encoding</span><span class="p">)</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://kid.chosun.com/list_kj.html?catid=1'</span><span class="p">)</span>
<span class="c1"># ë°©ë²• 1
# request.encoding = 'euc-kr'
</span>
<span class="c1"># ë°©ë²• 2
</span><span class="k">if</span> <span class="s">'charset'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'content-type'</span><span class="p">]:</span>
    <span class="n">request</span><span class="p">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">apparent_encoding</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>text/html
CP949
ISO-8859-1
</code></pre></div></div>

<hr />

<h3 id="code">Code</h3>

<h4 id="itemspy">items.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># -*- coding: utf-8 -*-
</span>
<span class="kn">import</span> <span class="nn">scrapy</span>


<span class="k">class</span> <span class="nc">KidNewScrawlingItem</span><span class="p">(</span><span class="n">scrapy</span><span class="p">.</span><span class="n">Item</span><span class="p">):</span>
    <span class="c1"># define the fields for your item here like:
</span>    <span class="n">url</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span> <span class="c1"># ê¸°ì‚¬ ì›ë¬¸ URL
</span>    <span class="n">title</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span> <span class="c1"># ì œëª©
</span>    <span class="n">subtitle</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span> <span class="c1"># ë¶€ì œëª©
</span>    <span class="n">author</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span> <span class="c1"># ê¸°ì
</span>    <span class="n">date</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span> <span class="c1"># ë‚ ì§œ   
</span>    <span class="n">article</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span> <span class="c1"># ê¸°ì‚¬ ë‚´ìš©
</span>    <span class="n">img_path</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span> <span class="c1"># ê¸°ì‚¬ img ê²½ë¡œ
</span>    <span class="n">source</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span> <span class="c1"># ì‹ ë¬¸ì‚¬
#     category = scrapy.Field() # ì¹´í…Œê³ ë¦¬
</span>    <span class="k">pass</span>
</code></pre></div></div>

<h4 id="spiderskidnews_spiderpy">spiders/kidnews_spider.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># -*- coding: utf-8 -*-
</span>
<span class="kn">import</span> <span class="nn">scrapy</span>
<span class="kn">from</span> <span class="nn">kidnewscrawling.items</span> <span class="kn">import</span> <span class="n">KidNewScrawlingItem</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">class</span> <span class="nc">KidNewsSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="p">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">"kidNewsCrawler"</span>
    
    <span class="k">def</span> <span class="nf">start_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s">'http://kid.chosun.com/list_kj.html?catid=1&amp;pn={page}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">parse_url</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">parse_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># ì¸ì½”ë”© ë³€í™˜
</span>        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">encoding</span> <span class="o">==</span> <span class="s">'cp1252'</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s">'euc-kr'</span><span class="p">)</span>
        
        <span class="n">default_url</span> <span class="o">=</span> <span class="s">'http://kid.chosun.com'</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">default_url</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@class="subject"]/a/@href'</span><span class="p">).</span><span class="n">extract</span><span class="p">()))</span>
        
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">response</span><span class="p">.</span><span class="n">follow</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">parse_article</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">parse_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">KidNewScrawlingItem</span><span class="p">()</span>
        
        <span class="c1"># ê¸°ì‚¬ url
</span>        <span class="n">item</span><span class="p">[</span><span class="s">"url"</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">url</span>
        
        <span class="c1"># ê¸°ì‚¬ ì œëª©
</span>        <span class="n">item</span><span class="p">[</span><span class="s">"title"</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//title/text()'</span><span class="p">).</span><span class="n">extract_first</span><span class="p">()</span>

        <span class="c1"># ê¸°ì‚¬ ë¶€ì œëª©, ì—†ëŠ” ê²½ìš°ë„ ì¡´ì¬
</span>        <span class="n">item</span><span class="p">[</span><span class="s">"subtitle"</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//h3/text()'</span><span class="p">).</span><span class="n">extract_first</span><span class="p">()</span>

        <span class="c1"># ê¸°ì, ê¸°ìê°€ ì•„ë‹Œ ê²½ìš°ë„ ì¡´ì¬
</span>        <span class="n">author</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//span[@class="author"]/text()'</span><span class="p">).</span><span class="n">extract_first</span><span class="p">()</span>
        <span class="n">item</span><span class="p">[</span><span class="s">"author"</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">'[\r\n\tì •ë¦¬=]'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">author</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># ì…ë ¥ë‚ ì§œ
</span>        <span class="n">date</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//span[@class="date"]/text()'</span><span class="p">).</span><span class="n">extract_first</span><span class="p">()</span>
        <span class="n">item</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">'[\r\n\t]'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">date</span><span class="p">).</span><span class="n">strip</span><span class="p">()[</span><span class="mi">5</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>
        
        <span class="c1"># ë³¸ë¬¸
</span>        <span class="n">p</span> <span class="o">=</span> <span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@class="Paragraph"]</span><span class="se">\
</span><span class="s">                                                [not(contains(@class, "center_img")) </span><span class="se">\
</span><span class="s">                                                and not(contains(@class, "right_img"))]//text()'</span><span class="p">).</span><span class="n">extract</span><span class="p">())</span>
        <span class="n">item</span><span class="p">[</span><span class="s">"article"</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">'[\r\n\t&lt;ì‚¬ì§„&gt;\xa0]'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">p</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># ê¸°ì‚¬ ì²« ì‚¬ì§„ ì´ë¯¸ì§€ url
</span>        <span class="n">item</span><span class="p">[</span><span class="s">"img_path"</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//img[@id="artImg0"]/@src'</span><span class="p">).</span><span class="n">extract_first</span><span class="p">()</span>
        
        <span class="c1"># ì‹ ë¬¸ì§€
</span>        <span class="n">item</span><span class="p">[</span><span class="s">"source"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"ì–´ë¦°ì´ì¡°ì„ ì¼ë³´"</span>

        <span class="k">yield</span> <span class="n">item</span>
</code></pre></div></div>

<h4 id="settingspy">settings.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BOT_NAME</span> <span class="o">=</span> <span class="s">'kidnewscrawling'</span>

<span class="n">SPIDER_MODULES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'kidnewscrawling.spiders'</span><span class="p">]</span>
<span class="n">NEWSPIDER_MODULE</span> <span class="o">=</span> <span class="s">'kidnewscrawling.spiders'</span>

<span class="c1"># í•œê¸€ê¹¨ì§
</span><span class="n">FEED_EXPORT_ENCODING</span> <span class="o">=</span> <span class="s">'utf-8'</span>

<span class="p">...</span>

<span class="c1"># Obey robots.txt rules
</span><span class="n">ROBOTSTXT_OBEY</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># mongodb setting
</span><span class="n">LOG_LEVEL</span><span class="o">=</span><span class="s">'ERROR'</span>

<span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span><span class="s">'kidnewscrawling.pipelines.MongoPipeline'</span><span class="p">:</span> <span class="mi">300</span><span class="p">,}</span>

<span class="n">MONGO_URI</span> <span class="o">=</span> <span class="s">'mongodb://root:1234@localhost:27017'</span>
<span class="n">MONGO_DATABASE</span> <span class="o">=</span> <span class="s">'newsDB'</span>
</code></pre></div></div>

<h4 id="pipelinespy">pipelines.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># -*- coding: utf-8 -*-
</span>
<span class="kn">import</span> <span class="nn">pymongo</span>
<span class="kn">from</span> <span class="nn">itemadapter</span> <span class="kn">import</span> <span class="n">ItemAdapter</span>

<span class="k">class</span> <span class="nc">MongoPipeline</span><span class="p">:</span>

    <span class="n">collection_name</span> <span class="o">=</span> <span class="s">'news'</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongo_uri</span><span class="p">,</span> <span class="n">mongo_db</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">mongo_uri</span> <span class="o">=</span> <span class="n">mongo_uri</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">mongo_db</span> <span class="o">=</span> <span class="n">mongo_db</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">from_crawler</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">crawler</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
            <span class="n">mongo_uri</span><span class="o">=</span><span class="n">crawler</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'MONGO_URI'</span><span class="p">),</span>
            <span class="n">mongo_db</span><span class="o">=</span><span class="n">crawler</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'MONGO_DATABASE'</span><span class="p">,</span> <span class="s">'items'</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">open_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="p">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">mongo_uri</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">client</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">mongo_db</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">close_spider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">"title"</span><span class="p">])</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">db</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">collection_name</span><span class="p">].</span><span class="n">insert_one</span><span class="p">(</span><span class="n">ItemAdapter</span><span class="p">(</span><span class="n">item</span><span class="p">).</span><span class="n">asdict</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">item</span>
</code></pre></div></div>

<h3 id="scrapy-ì‹¤í–‰">scrapy ì‹¤í–‰</h3>
<ul>
  <li>spiders/kidnews_spider.pyì˜ í´ë˜ìŠ¤ ë‚´ ì´ë¦„</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scrapy crawl kidNewsCrawler
</code></pre></div></div>

<h3 id="ref">ref</h3>
<ul>
  <li><a href="https://devbull.xyz/python-create-environment/">ğŸ”— ê°€ìƒí™˜ê²½ ê´€ë ¨</a></li>
  <li>https://excelsior-cjh.tistory.com/86</li>
  <li>https://dev-jacob.tistory.com/entry/Python-Requests-í•œê¸€-ê¹¨ì§-ë¬¸ì œ-í•´ê²°í•˜ê¸°</li>
</ul>
:ET