I"’Q<hr />
<h3 id="mongodb-shell">MongoDB Shell</h3>
<ul>
  <li>MongoDB Shell Overall</li>
  <li>MongoDB Shell Find</li>
  <li>MongoDB Shell Update &amp; Remove &amp; Drop</li>
  <li>MongoDB Shell Aggregate</li>
</ul>

<hr />

<h3 id="mongodb-shell-overall">MongoDB Shell Overall</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì ‘ì†</span>
mongosh <span class="nt">-u</span> <span class="s2">"root"</span> <span class="nt">-p</span> <span class="s2">"1234"</span> 

<span class="c"># show all DB</span>
show dbs<span class="p">;</span>

<span class="c"># db ìƒì„± ë° í•´ë‹¹ dbë¡œ ì ‘ì† (use [db_name])</span>
use testDB<span class="p">;</span>

<span class="c"># í˜„ì¬ ì ‘ì†í•´ìˆëŠ” db ì‚­ì œ</span>
db.dropDatabase<span class="o">()</span><span class="p">;</span>

<span class="c"># collection ë§Œë“¤ê¸°</span>
db.createCollection<span class="o">(</span><span class="s2">"user"</span><span class="o">)</span><span class="p">;</span>

<span class="c"># user collection(rdbms:table)ì— documents(row) ì¶”ê°€</span>
db.user.insertMany<span class="o">([</span>
  <span class="o">{</span>uName: <span class="s2">"Tom"</span>, <span class="nb">pwd</span>: <span class="s2">"1111"</span>, age: 20<span class="o">}</span>,
  <span class="o">{</span>uName: <span class="s2">"Jane"</span>, <span class="nb">pwd</span>: <span class="s2">"2222"</span>, age: 30<span class="o">}</span>,
<span class="o">])</span><span class="p">;</span>

<span class="c"># document ì¶”ê°€</span>
db.user.insertOne<span class="o">({</span>uName: <span class="s2">"zsu"</span>, <span class="nb">pwd</span>: <span class="s2">"6666"</span><span class="o">})</span><span class="p">;</span>

<span class="c"># ì „ì²´ documents ë³´ê¸°</span>
db.user.find<span class="o">()</span><span class="p">;</span>

<span class="c"># uNameì´ Tomì¸ row ë³´ê¸°</span>
db.user.find<span class="o">({</span>uName:<span class="s2">"Tom"</span><span class="o">})</span><span class="p">;</span>

<span class="c"># uNameì´ Janeì¸ documentì˜ ë¹„ë°€ë²ˆí˜¸ 4444ë¡œ ë°”ê¾¸ê¸°</span>
db.user.update<span class="o">({</span>uName:<span class="s2">"Jane"</span><span class="o">}</span>, <span class="o">{</span><span class="nv">$set</span>: <span class="o">{</span><span class="nb">pwd</span>:4444<span class="o">}})</span><span class="p">;</span>

<span class="c"># uNameì´ Janeì¸ document ì‚­ì œ</span>
db.user.deleteOne<span class="o">({</span>uName:<span class="s2">"Jane"</span><span class="o">})</span><span class="p">;</span>
</code></pre></div></div>
<hr />

<h3 id="mongodb-shell-find">MongoDB Shell Find</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># collection ë§Œë“¤ê¸°</span>
db.createCollection<span class="o">(</span><span class="s2">"score"</span><span class="o">)</span><span class="p">;</span>

<span class="c"># document ì¶”ê°€</span>
db.score.insertMany<span class="o">(</span>
  <span class="o">{</span>name: <span class="s2">"Sophia"</span>, point:99<span class="o">}</span>,
  <span class="o">{</span>name: <span class="s2">"Alice"</span>, point:85<span class="o">}</span>,
  <span class="o">{</span>name: <span class="s2">"Jane"</span>, point:76<span class="o">}</span>,
  <span class="o">{</span>name: <span class="s2">"James"</span>, point:64<span class="o">}</span>,
<span class="o">)</span><span class="p">;</span>

<span class="c"># ë¯¸ë¦¬ listì„ ë§Œë“¤ì–´ë‘ê³  ì¶”ê°€</span>
var names <span class="o">=</span> <span class="o">[</span><span class="s2">"Jane"</span>, <span class="s2">"Tom"</span>, <span class="s2">"Alice"</span>, <span class="s2">"James"</span>, <span class="s2">"Sophia"</span><span class="o">]</span><span class="p">;</span>
var points <span class="o">=</span> <span class="o">[</span>76,54,85,64,99]<span class="p">;</span>
<span class="k">for</span> <span class="o">(</span><span class="nv">i</span><span class="o">=</span>0<span class="p">;</span> i&lt;names.length<span class="p">;</span> i++<span class="o">){</span>
  db.score.insertOne<span class="o">({</span>name:names[i], point:points[i]<span class="o">})</span><span class="p">;</span>
  <span class="o">}</span><span class="p">;</span>

<span class="c"># pointê°€ 90ì  ì´ˆê³¼ì¸ ë°ì´í„° ì°¾ê¸°</span>
db.score.find<span class="o">({</span>point:<span class="o">{</span><span class="nv">$gt</span>:90<span class="o">}})</span><span class="p">;</span>

<span class="c"># pointê°€ 70ì  ì´ˆê³¼ì¸ ì²« ë²ˆì§¸ ë°ì´í„° ì°¾ê¸°</span>
db.score.findOne<span class="o">({</span>point:<span class="o">{</span><span class="nv">$gt</span>:70<span class="o">}})</span><span class="p">;</span>

<span class="c"># pointê°€ 60ì  ì´ìƒ 90ì¡ˆ ì´í•˜ì¸ ë°ì´í„° ì°¾ê¸°</span>
db.score.find<span class="o">({</span>point:<span class="o">{</span><span class="nv">$gte</span>:60, <span class="nv">$lte</span>:90<span class="o">}})</span><span class="p">;</span>
<span class="c"># ìœ„ì™€ ê°™ìŒ</span>
db.score.find<span class="o">({</span>point:<span class="o">{</span><span class="nv">$gte</span>:60<span class="o">}</span>, point:<span class="o">{</span><span class="nv">$lte</span>:90<span class="o">}})</span><span class="p">;</span>

<span class="c"># pointê°€ 54, 76, 99ì  ì¤‘ ìˆëŠ” ë°ì´í„° ì°¾ê¸°</span>
db.score.find<span class="o">({</span>point:<span class="o">{</span><span class="nv">$in</span>:[54,76,99]<span class="o">}})</span><span class="p">;</span>

<span class="c"># pointê°€ 54, 76, 99ì  ì™¸ì˜ ë°ì´í„° ì°¾ê¸°</span>
db.score.find<span class="o">({</span>point:<span class="o">{</span><span class="nv">$nin</span>:[54,76,99]<span class="o">}})</span><span class="p">;</span>

<span class="c"># pointê°€ 60 ì´í•˜ or 90 ì´ìƒì¸ ë°ì´í„°ë§Œ ì°¾ê¸°</span>
db.score.find<span class="o">(</span>
  <span class="o">{</span>
    <span class="nv">$or</span>:[
      <span class="o">{</span>point:<span class="o">{</span><span class="nv">$lte</span>:60<span class="o">}}</span>,<span class="o">{</span>point:<span class="o">{</span><span class="nv">$gte</span>:90<span class="o">}}</span>
      <span class="o">]</span>
  <span class="o">}</span>
<span class="o">)</span><span class="p">;</span>

<span class="c"># point columnì´ ìˆëŠ” document ì°¾ê¸°</span>
db.score.find<span class="o">({</span>point:<span class="o">{</span><span class="nv">$exists</span>:true<span class="o">}})</span><span class="p">;</span>

<span class="c"># point columnì´ ì—†ëŠ” document ì°¾ê¸°</span>
db.score.find<span class="o">({</span>age:<span class="o">{</span><span class="nv">$exists</span>:false<span class="o">}})</span><span class="p">;</span>

<span class="c"># db.collection.find({condition},{column:0/1}), 0=don't show, 1=show</span>
<span class="c"># pointê°€ 76ì  ì´ìƒì¸ documentì˜ ì´ë¦„ë§Œ ì°¾ê¸°</span>
db.score.find<span class="o">({</span>point:<span class="o">{</span><span class="nv">$gte</span>:76<span class="o">}}</span>,<span class="o">{</span>_id:0, name:1<span class="o">})</span><span class="p">;</span>

<span class="c"># limit query result to 2</span>
db.score.find<span class="o">()</span>.limit<span class="o">(</span>2<span class="o">)</span><span class="p">;</span>

<span class="c"># skip two document</span>
db.score.find<span class="o">()</span>.skip<span class="o">(</span>2<span class="o">)</span><span class="p">;</span>

<span class="c"># sort by point(ascending)</span>
db.score.find<span class="o">()</span>.sort<span class="o">({</span>point:1<span class="o">})</span><span class="p">;</span>

<span class="c"># sort by point(descending)</span>
db.score.find<span class="o">()</span>.sort<span class="o">({</span>point:-1<span class="o">})</span><span class="p">;</span>

<span class="c"># document ì¤‘ nameì´ Janeì´ë©´ì„œ certi columnì´ ìˆëŠ” document ì œê±°</span>
db.score.deleteOne<span class="o">({</span>name:<span class="s2">"Jane"</span>, certi:<span class="o">{</span><span class="nv">$exists</span>:true<span class="o">}})</span><span class="p">;</span>
</code></pre></div></div>
<hr />

<h3 id="mongodb-shell-update--remove--drop">MongoDB Shell Update &amp; Remove &amp; Drop</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.test.insertMany<span class="o">(</span>
  <span class="o">[</span>
    <span class="o">{</span>name:<span class="s2">"Jane"</span>, certi:[<span class="s2">"Java"</span>, <span class="s2">"OS"</span>, <span class="s2">"Excel"</span><span class="o">]}</span>,
    <span class="o">{</span>name:<span class="s2">"Tom"</span>, certi:[<span class="s2">"DB"</span>, <span class="s2">"Secuity"</span><span class="o">]}</span>,
    <span class="o">{</span>title:<span class="s2">"IT Trend"</span>, author:<span class="s2">"James"</span>, price:5000<span class="o">}</span>,
    <span class="o">{</span>name:<span class="s2">"Alice"</span>, certi:[<span class="s2">"PPT"</span>, <span class="s2">"SQL"</span>, <span class="s2">"Web"</span><span class="o">]}</span>,
    <span class="o">{</span>name:<span class="s2">"John"</span>, age:34<span class="o">}</span>
  <span class="o">]</span>
<span class="o">)</span><span class="p">;</span>

<span class="c"># nameì´ Johnì¸ documentì˜ age column ì‚­ì œ</span>
db.score.update<span class="o">({</span>name:<span class="s2">"John"</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$unset</span>:<span class="o">{</span>age:34<span class="o">}})</span><span class="p">;</span>

<span class="c"># titleì´ IT Trendì¸ documentì—ì„œ price: 35000ì´ë¼ëŠ” column ì¶”ê°€</span>
db.score.update<span class="o">({</span>title:<span class="s2">"IT Trend"</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$set</span>:<span class="o">{</span>price:35000<span class="o">}})</span><span class="p">;</span>

<span class="c"># titleì´ IT Trendì¸ documentì—ì„œ price: 35000ì—ì„œ 70000ìœ¼ë¡œ ë³€ê²½</span>
db.score.update<span class="o">({</span>title:<span class="s2">"IT Trend"</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$set</span>:<span class="o">{</span>price:70000<span class="o">}})</span><span class="p">;</span>

<span class="c"># nameì´ Johnì¸ documentì—ì„œ cert:["OS", "DB"]ì´ë¼ëŠ” column ì¶”ê°€</span>
db.score.update<span class="o">({</span>name:<span class="s2">"John"</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$set</span>:<span class="o">{</span>certi:[<span class="s2">"OS"</span>, <span class="s2">"DB"</span><span class="o">]}})</span><span class="p">;</span>

<span class="c"># nameì´ Johnì¸ documentì—ì„œ cert columnì— Word ì¶”ê°€</span>
db.score.update<span class="o">({</span>name:<span class="s2">"John"</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$push</span>:<span class="o">{</span>certi:<span class="s2">"Word"</span><span class="o">}})</span><span class="p">;</span>

<span class="c"># nameì´ Johnì¸ documentì—ì„œ cert columnì— Word ì œê±°</span>
db.score.update<span class="o">({</span>name:<span class="s2">"John"</span><span class="o">}</span>,<span class="o">{</span><span class="nv">$pull</span>:<span class="o">{</span>certi:<span class="s2">"Word"</span><span class="o">}})</span><span class="p">;</span>

<span class="c"># nameì´ Janeì¸ document ì œê±°</span>
db.score.remove<span class="o">({</span>name:<span class="s2">"Jane"</span><span class="o">})</span><span class="p">;</span>

<span class="c"># collectionì˜ documents ì‚­ì œ</span>
db.score.remove<span class="o">({})</span><span class="p">;</span>

<span class="c"># collection ì‚­ì œ</span>
db.score.drop<span class="o">()</span><span class="p">;</span>
</code></pre></div></div>
<hr />

<h3 id="mongodb-shell-aggregate">MongoDB Shell Aggregate</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># select deptno, and dname</span>
db.dept.aggregate<span class="o">([</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$project</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: 0, <span class="s2">"deptno"</span>: 1, <span class="s2">"dname"</span>: 1<span class="o">}}</span>
<span class="o">])</span><span class="p">;</span>

<span class="c"># select deptno, and dname, and limit the data to 3</span>
db.dept.aggregate<span class="o">([</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$project</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: 0, <span class="s2">"deptno"</span>: 1, <span class="s2">"dname"</span>: 1<span class="o">}}</span>, <span class="o">{</span><span class="s2">"</span><span class="nv">$limit</span><span class="s2">"</span>: 2<span class="o">}</span>
<span class="o">])</span><span class="p">;</span>

<span class="c"># count all documents in dept collection</span>
db.dept.aggregate<span class="o">([</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$group</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: 0, <span class="s2">"count"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$sum</span><span class="s2">"</span>:1<span class="o">}}}</span>
<span class="o">])</span>

<span class="c"># count employees by deptno</span>
db.emp.aggregate<span class="o">([</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$group</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: <span class="s2">"</span><span class="nv">$deptno</span><span class="s2">"</span>, <span class="s2">"count"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$sum</span><span class="s2">"</span>: 1<span class="o">}}}</span>
<span class="o">])</span>

<span class="c"># sum of salary by deptno</span>
db.emp.aggregate<span class="o">([</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$group</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: <span class="s2">"</span><span class="nv">$deptno</span><span class="s2">"</span>, <span class="s2">"count"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$sum</span><span class="s2">"</span>: <span class="s2">"</span><span class="nv">$sal</span><span class="s2">"</span><span class="o">}}}</span>
<span class="o">])</span>

<span class="c"># mean of salary by job</span>
db.emp.aggregate<span class="o">([</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$group</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: <span class="s2">"</span><span class="nv">$job</span><span class="s2">"</span>, <span class="s2">"count"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$avg</span><span class="s2">"</span>: <span class="s2">"</span><span class="nv">$sal</span><span class="s2">"</span><span class="o">}}}</span>
<span class="o">])</span>

<span class="c"># round mean of salary by job</span>
db.emp.aggregate<span class="o">([</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$group</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: <span class="s2">"</span><span class="nv">$job</span><span class="s2">"</span>, <span class="s2">"avg"</span>:<span class="o">{</span><span class="s2">"</span><span class="nv">$avg</span><span class="s2">"</span>: <span class="s2">"</span><span class="nv">$sal</span><span class="s2">"</span><span class="o">}}}</span>, 
  <span class="o">{</span><span class="s2">"</span><span class="nv">$addFields</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"avg"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$round</span><span class="s2">"</span>:[<span class="s2">"</span><span class="nv">$avg</span><span class="s2">"</span>, <span class="nt">-1</span><span class="o">]}}}</span> 
<span class="o">])</span>

<span class="c"># dept collectionì„ ê¸°ì¤€ìœ¼ë¡œ emp collection join í•œ ë’¤ dept_emp_joinì´ë¼ëŠ” collectionì— ì €ì¥</span>
<span class="c"># from - joinë  collection name (emp)</span>
<span class="c"># localField - dept collectionì˜ ê¸°ì¤€ field</span>
<span class="c"># foreignField - emp collectionì˜ ê¸°ì¤€ field</span>
<span class="c"># as - ê¸°ì¤€ collection(dept)ì— ìƒˆë¡œìš´ filedê°€ ë§Œë“¤ì–´ì§€ë©° í•´ë‹¹ filed ì•„ë˜ì— ê¸°ì¤€ì— ë§ëŠ” emp collectionì˜ objectì´ ë“¤ì–´ê°</span>
db.dept.aggregate<span class="o">([</span>
  <span class="o">{</span>
    <span class="s2">"</span><span class="nv">$lookup</span><span class="s2">"</span>:
      <span class="o">{</span>
        <span class="s2">"from"</span>: <span class="s2">"emp"</span>, 
        <span class="s2">"localField"</span>: <span class="s2">"deptno"</span>, 
        <span class="s2">"foreignField"</span>: <span class="s2">"deptno"</span>, 
        <span class="s2">"as"</span>: <span class="s2">"dno"</span>
      <span class="o">}</span>
  <span class="o">}</span>,
  <span class="o">{</span><span class="s2">"</span><span class="nv">$out</span><span class="s2">"</span>: <span class="s2">"dept_emp_join"</span><span class="o">}</span>
<span class="o">])</span>

<span class="c"># dname ê°œìˆ˜</span>
db.dept_emp_join.aggregate<span class="o">(</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$unwind</span><span class="s2">"</span>: <span class="s2">"</span><span class="nv">$dno</span><span class="s2">"</span><span class="o">}</span>,
  <span class="o">{</span><span class="s2">"</span><span class="nv">$group</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: 0, <span class="s2">"count"</span>:<span class="o">{</span><span class="s2">"</span><span class="nv">$sum</span><span class="s2">"</span>:1<span class="o">}}}</span>
<span class="o">)</span>

<span class="c"># dnameë³„ ì¸ì› ìˆ˜</span>
db.dept_emp_join.aggregate<span class="o">(</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$unwind</span><span class="s2">"</span>: <span class="s2">"</span><span class="nv">$dno</span><span class="s2">"</span><span class="o">}</span>,
  <span class="o">{</span><span class="s2">"</span><span class="nv">$group</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: <span class="s2">"</span><span class="nv">$dname</span><span class="s2">"</span>, <span class="s2">"count"</span>:<span class="o">{</span><span class="s2">"</span><span class="nv">$sum</span><span class="s2">"</span>:1<span class="o">}}}</span>
<span class="o">)</span>

<span class="c"># dname ë³„ ê¸‰ì—¬ í•©ê³„</span>
db.dept_emp_join.aggregate<span class="o">(</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$unwind</span><span class="s2">"</span>: <span class="s2">"</span><span class="nv">$dno</span><span class="s2">"</span><span class="o">}</span>,
  <span class="o">{</span><span class="s2">"</span><span class="nv">$group</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"_id"</span>: <span class="s2">"</span><span class="nv">$dname</span><span class="s2">"</span>, <span class="s2">"sum"</span>:<span class="o">{</span><span class="s2">"</span><span class="nv">$sum</span><span class="s2">"</span>: <span class="s2">"</span><span class="nv">$dno</span><span class="s2">.sal"</span><span class="o">}}}</span>
<span class="o">)</span>

<span class="c"># Accounting ë¶€ì„œ ì†Œì† ì§ì›ë“¤ì˜ ì‚¬ë²ˆ, ì´ë¦„, ê¸‰ì—¬ëŠ”? ê¸‰ì—¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ascendingí•˜ê²Œ sort, (descendingì¼ ê²½ìš° -1)</span>
db.dept_emp_join.aggregate<span class="o">(</span>
  <span class="o">{</span><span class="s2">"</span><span class="nv">$match</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"dname"</span>: <span class="s2">"ACCOUNTING"</span><span class="o">}}</span>,
  <span class="o">{</span><span class="s2">"</span><span class="nv">$unwind</span><span class="s2">"</span>: <span class="s2">"</span><span class="nv">$dno</span><span class="s2">"</span><span class="o">}</span>,
  <span class="o">{</span><span class="s2">"</span><span class="nv">$project</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"dno.empno"</span>: 1, <span class="s2">"dno.ename"</span>: 1, <span class="s2">"dno.sal"</span>: 1<span class="o">}}</span>,
  <span class="o">{</span><span class="s2">"</span><span class="nv">$sort</span><span class="s2">"</span>: <span class="o">{</span><span class="s2">"dno.sal"</span>: 1<span class="o">}}</span>
<span class="o">)</span>
</code></pre></div></div>
<hr />

<h3 id="ref">ref</h3>
<ul>
  <li><a href="https://docs.mongodb.com/manual/reference/mongo-shell/#command-helpers">ğŸ”— MongoDB Shell Command ê³µì‹ë¬¸ì„œ</a></li>
</ul>
:ET