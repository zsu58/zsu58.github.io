---
title: "[Docker] DevContainer"
layout: single
date: '20/04/2022'
toc: true
toc_sticky: true
toc_label: Table of Contents
categories:
  - DOCKER
tags:
  - DOCKER
  - VSCODE
---

---
### DevContainer
* SSH to EC2(Mac ê¸°ì¤€)
* Script to Install Docker on EC2(Ubuntu)
* VSCode DevContainer
* CLI to remote Docker

---

### SSH to EC2
```bash
# generate a new ssh key(a new key is made in the ~/.ssh dir)
ssh-keygen -t ed25519 -C "carl020958@korea.ac.kr"

# start ssh-agent in the background
eval "$(ssh-agent -s)"

# check to see if your ~/.ssh/config file exists in the default location
open ~/.ssh/config

# if the file doesn't exist, create the file
touch ~/.ssh/config

# open the file and modify the file to contain the following lines(check whether id_ed25519 is right)
Host *
  AddKeysToAgent yes
  UseKeychain yes
  IdentityFile ~/.ssh/id_ed25519

# Add SSH private key to the ssh-agent and store passphrase in the keychain
ssh-add ~/.ssh/id_ed25519

# paste the ssh key in ec2
scp -i /Users/zsu/Projects/DE/aws/ubuntu_test.pem /Users/zsu/.ssh/id_ed25519.pub ubuntu@[IP-Address]:/home/ubuntu/.ssh/

# (EC2ì—ì„œ)
cat id_ed25519.pub >> ~/.ssh/authorized_keys

# ssh to ec2
ssh ubuntu@[IP-Address]
```

---

### Script to Install Docker on EC2(Ubuntu)
```bash
#!/usr/bin/env bash

export DEBIAN_FRONTEND=noninteractive
export HOME=/root

# System dependencies
apt-get update && apt-get install -y make nano

# Install Docker
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
echo \
"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
apt-get update && apt-get install -y docker-ce docker-ce-cli containerd.io

# Install Docker Compose
curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

# Enable standard user (ubuntu) to manage containers (required for Remote Containers)
groupadd docker
usermod -aG docker ubuntu
newgrp docker
```
---

### VSCode DevContainer
```bash
# Command+Shift+P ëˆ„ë¥¸ í›„ ì•„ë˜ ì‚¬í•­ ê²€ìƒ‰
remote-ssh connect to host

# Add New SSH Host í´ë¦­ í›„, ssh ê³„ì •@IPì£¼ì†Œ ì…ë ¥
ssh ubuntu@[IP-Address]

# config íŒŒì¼ì— ì €ì¥ (~/.ssh/config ì„ íƒ)

# config íŒŒì¼ì˜ ì—°ê²°í•  EC2ì— IdentityFile ì¶”ê°€
Host [IP-Address]
  HostName [IP-Address]
  User ubuntu
  IdentityFile ~/.ssh/id_ed25519


# Command+Shift+p ëˆ„ë¥¸ í›„ ì•„ë˜ ì‚¬í•­ ê²€ìƒ‰
remote-ssh connect to host

# EC2ì˜ IPì£¼ì†Œ ëˆ„ë¥´ë©´ í•´ë‹¹ EC2ë¡œ ì§„ì…
# ì´ ìƒíƒœì—ì„œ Remote Container ì‚¬ìš©í•˜ë©´ EC2ì˜ Docker Containerì— ì—°ê²° ê°€ëŠ¥
```

---

### CLI to remote Docker
```bash
docker context create devcont_zsu --docker "host=ssh://ubuntu@[IP-Address]"
docker context use devcont_zsu

# ì›ë˜ëŒ€ë¡œ ëŒì•„ì˜¤ê¸°
docker context use default
```

### ref
* [ğŸ”— ì°¸ê³ 1](https://blog.doppler.com/visual-studio-code-remote-dev-containers-on-aws)
* [ğŸ”— ì°¸ê³ 2](https://medium.com/sjk5766/vs-code-local-remote-container-ê°œë°œí™˜ê²½-ad0b2c2eb472)
* [ğŸ”— Docker](https://medium.com/sjk5766/vs-code-local-remote-container-ê°œë°œí™˜ê²½-ad0b2c2eb472)

