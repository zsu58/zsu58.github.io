---
title: "[Apache Airflow] Airflow DB to Postgres(Docker)"
layout: single
date: '08/01/2022'
toc: true
toc_sticky: true
toc_label: Table of Contents
categories:
  - AIRFLOW
tags:
  - AIRFLOW
  - DOCKER
---

---
### Airflow DB to Postgres(Docker)
* [ğŸ”— Airflow Localì— ì„¤ì¹˜](https://carl020958.github.io/airflow/airflow2/) / [ğŸ”— Airflow Dockerì— ì„¤ì¹˜](https://carl020958.github.io/airflow/airflow5/)
* Postgres Container ì„¤ì¹˜
* PostgreSQL DB ë° DB User ìƒì„±
* airflow.cfg ìˆ˜ì •1
* pycopg2-binary ì„¤ì¹˜
* airflow db ì´ˆê¸°í™”
* airflow.cfg ìˆ˜ì •2

---

### Postgres Container ì„¤ì¹˜

```bash
# container ìƒì„±
docker run -p 5432:5432 --name postgres1 -e POSTGRES_PASSWORD=1234 -d -v psql_data:/var/lib/postgresql/data postgres

# postgres shell ì ‘ì†
docker exec -it postgres1 bash
su - postgres
psql
```
---

### PostgreSQL DB ë° DB User ìƒì„±
* Postgres shellì—ì„œ DB ë° DB User ìƒì„±

```bash
# DB ìƒì„± (CREATE DATABASE [db_name])
CREATE DATABASE airflow_db;

# DB USER ìƒì„± (CREATE USER [id] with password '[password]';)
CREATE USER admin with password 'admin';

# user ìƒì„± í™•ì¸
\du
```
---

### airflow.cfg ìˆ˜ì •1
```bash
# airflow.cfg
sql_alchemy_conn = postgresql+psycopg2://admin:admin@localhost/airflow_db
```

### pycopg2-binary ì„¤ì¹˜
```bash
# ê°€ìƒí™˜ê²½ ì ‘ì† í›„
pip3 install psycopg2-binary
```
---

### airflow db ì´ˆê¸°í™”
```bash
# airflow db init
airflow db init

# user ìƒì„±
airflow users create -u admin -p admin -f jisu -l park -r Admin -e carl020958@korea.ac.kr

# ì´ˆê¸°í™” í™•ì¸
docker exec -it postgres1 bash
su - postgres
# psql -U [db_user] [db_name]
psql -U admin -d airflow_db

# ìƒì„±ëœ í…Œì´ë¸” í™•ì¸
\dt

# user í™•ì¸
SELECT * FROM ab_user;
```
---

### airflow.cfg ìˆ˜ì •2
```bash
# airflow.cfg
executor = LocalExecutor
```
---

### ref 
* [ğŸ”— ì°¸ê³  ë¸”ë¡œê·¸](https://velog.io/@insutance/Airflow-DB-ë³€ê²½-SQLite-to-PostgreSQL)