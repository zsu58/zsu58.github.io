---
title: "[Apache Airflow] ShortCircuitOperator"
layout: single
date: '23/04/2022'
toc: true
toc_sticky: true
toc_label: Table of Contents
categories:
  - AIRFLOW
tags:
  - AIRFLOW
---

---
### ShortCircuitOperator
* Conditionì— ë”°ë¼ ë‹¤ìŒ Taskì˜ ì‹¤í–‰ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ê³ ìž í•  ë•Œ ì‚¬ìš©
* Operator ë‚´ì˜ Python í•¨ìˆ˜ê°€ Trueì¸ ê²½ìš° ë‹¤ìŒ Task ì§„í–‰, ì•„ë‹ ê²½ìš° Dagì„ ì¢…ë£Œì‹œí‚´
    * check_s3ì˜ s3_data_loadê°€ Trueì¸ ê²½ìš° kid_wordcount Taskê°€ ì‹¤í–‰
    * check_s3ì˜ s3_data_loadê°€ Falseì¸ ê²½ìš° ì´ í›„ì˜ TaskëŠ” ëª¨ë‘ Skip ë¨

```python
...
from airflow.operators.python import ShortCircuitOperator
...

...
def s3_data_load():
    """check whether data was crawled"""
    s3_client = boto3.client(
        "s3", 
        aws_access_key_id = Variable.get("AWS_ACCESS_KEY_ID"),
        aws_secret_access_key = Variable.get("AWS_SECRET_ACCESS_KEY")
    )
    today = datetime.strftime(datetime.now() + timedelta(hours=9), "%Y-%m-%d")
    Bucket, path = Variable.get("Bucket"), f'{Variable.get("kid_news_dir")}/{today}'

    res = s3_client.list_objects_v2(Bucket=Bucket, Prefix=path, MaxKeys=1)
    return 'Contents' in res
...

...
# task to check whether data exists
check_s3 = ShortCircuitOperator(
    task_id="check_s3",
    python_callable=s3_data_load,
    dag=dag)
...

...
kid_news_scrapy >> check_s3 >> kid_wordcount
```

---

### ref 
* [ðŸ”— ì°¸ê³ ](https://medium.com/@loraxman/how-and-why-of-airflow-shortciruitoperator-85dcbeddb1ba)
